<div class="admin-container">
  
  <div class="admin-header">
    <div class="title-box">
      <h1>User Management</h1>
      <p>Configure staff roles and active memberships</p>
    </div>
    
    <div class="search-box">
      <span class="material-icons">search</span>
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (ngModelChange)="onSearchChange()" 
        placeholder="Search names..."
      />
    </div>
  </div>

  <!-- <div class="glass-card form-section" [class.is-editing]="editingUser">
    <div class="card-header">
      <span class="material-icons">{{ editingUser ? 'edit' : 'add_circle' }}</span>
      <h3>{{ editingUser ? 'Modify User' : 'New Registration' }}</h3>
    </div>

    <form [formGroup]="userForm" (ngSubmit)="saveUser()">
      <div class="form-grid">
        <div class="field">
          <label>Full Name</label>
          <input formControlName="fullName" placeholder="Ex: John Smith" />
        </div>
        <div class="field">
          <label>Email</label>
          <input formControlName="email" type="email" placeholder="john@company.com" />
        </div>
        <div class="field">
          <label>Phone</label>
          <input formControlName="mobileNumber" placeholder="555-0199" />
        </div>
      </div>

      <div class="form-controls">
        <div class="switches">
          <label class="toggle-cyber">
            <input type="checkbox" formControlName="isManager" />
            <span class="cyber-check"></span>
            <span class="text">Manager</span>
          </label>
          <label class="toggle-cyber">
            <input type="checkbox" formControlName="isOwner" />
            <span class="cyber-check"></span>
            <span class="text">Owner</span>
          </label>
        </div>

        <div class="btns">
          <button *ngIf="editingUser" type="button" class="btn-ghost" (click)="openAddUser()">Cancel</button>
          <button type="submit" [disabled]="userForm.invalid" class="btn-main">
            {{ editingUser ? 'Save' : 'Register' }}
          </button>
        </div>
      </div>
    </form>
  </div> -->
  

  <div class="list-container">
    <div *ngIf="loading" class="loader-line"></div>

    <div class="responsive-table-wrapper">
      <table class="cyber-table">
        <thead>
          <tr>
            <th>Identity</th>
            <th class="hide-mobile">Privileges</th>
            <th class="text-right">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users; let i = index">
            <td>
              <div class="user-cell">
                <div class="avatar">{{ user.fullName.charAt(0) }}</div>
                <div class="meta">
                  <span class="name">{{ user.fullName }}</span>
                  <span class="contact">{{ user.email }}</span>
                  <div class="mobile-tags show-mobile">
                    <span class="tag" *ngIf="user.isManager">Manager</span>
                    <span class="tag" *ngIf="user.isOwner">Owner</span>
                  </div>
                </div>
              </div>
            </td>
            <td class="hide-mobile">
              <div class="privilege-tags">
                <span class="tag" [class.active]="user.isManager">Manager</span>
                <span class="tag" [class.active]="user.isOwner">Owner</span>
              </div>
            </td>
            <td class="actions-cell">
              <div class="action-row" *ngIf="showCreateMembershipFeature !== (i + 1)">
                <button (click)="launchUserDetails(user._id)" class="btn-icon" title="View Profile">
                  <span class="material-icons">visibility</span>
                </button>
                <!-- <button (click)="openEditUser(user)" class="btn-icon"><span class="material-icons">edit</span></button> -->
                <mat-icon (click)="unblockUser(user)"  class="btn-icon" *ngIf="user.record.state == 0">check_circle</mat-icon>
                <mat-icon (click)="blockUser(user)"  class="btn-icon" *ngIf="user.record.state == 1">do_not_disturb_on</mat-icon>
                <button (click)="deleteUser(user)" class="btn-icon del"><span class="material-icons">delete</span></button>
                <button (click)="showCreateMembership(user, i)" class="btn-accent">+ Member</button>
                <button  *ngIf="user.record.state == 0"class="btn-red marginLeft10">Blocked</button>
              </div>
              
              <div *ngIf="(i + 1) === showCreateMembershipFeature" class="membership-inline">
                <select [(ngModel)]="selectedMembershipType">
                  <option *ngFor="let type of membershipTypes" [value]="type">{{ type }}</option>
                </select>
                <div class="inline-btns">
                  <button class="done" (click)="createMembership(user)">OK</button>
                  <button class="close" (click)="cancelCreateMembership()">Ã—</button>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div *ngIf="users.length === 0 && !loading" class="empty-state">
      <span class="material-icons">inventory_2</span>
      <p>No active users found</p>
    </div>
  </div>
</div>
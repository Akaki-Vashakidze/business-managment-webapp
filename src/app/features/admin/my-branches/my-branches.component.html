<div class="workspace-wrapper">
  
  <header class="page-header">
    <div class="title-meta">
      <h1>Operational Branches</h1>
      <p>Manage localized nodes and resource distribution.</p>
    </div>
    <button class="add-btn" [class.cancel]="addBranchMode" (click)="addBranchMode = !addBranchMode">
      <mat-icon>{{ addBranchMode ? 'close' : 'add_location' }}</mat-icon>
      {{ addBranchMode ? 'Cancel' : 'New Branch' }}
    </button>
  </header>

  <div class="form-reveal" *ngIf="addBranchMode">
    <app-add-branches (branchAdded)="onBranchAdded()"></app-add-branches>
  </div>

  <div class="branch-grid">
    <mat-card class="node-card" *ngFor="let branch of branches; let i = index">
      
      <div class="card-body">
        <div class="node-icon">
          <mat-icon>location_on</mat-icon>
        </div>

        <mat-card-header>
          <mat-card-title>{{ branch.name }}</mat-card-title>
          <mat-card-subtitle>Node ID: {{ branch._id.slice(-6) }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <p class="description">Active branch node. Manage specific inventory items and local settings.</p>
        </mat-card-content>
      </div>

      <div class="action-drawer" [class.is-open]="updateModeOn === i + 1">
        <button class="drawer-close" (click)="closeModes()">
          <mat-icon>close</mat-icon>
        </button>

        <div class="drawer-inner">
          <label>Update Branch Name</label>
          <div class="input-group">
            <input [(ngModel)]="updatedBranchName" [placeholder]="branch.name" />
            <button (click)="updateBranch(branch._id)">Save</button>
          </div>
        </div>
      </div>

      <mat-card-actions class="card-footer">
        <button mat-icon-button (click)="onUpdateModeChange(i + 1, branch.name)" title="Edit Node">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button class="btn-delete" (click)="deleteBranch(branch._id)" title="Decommission">
          <mat-icon>delete_outline</mat-icon>
        </button>
      </mat-card-actions>

    </mat-card>
  </div>

  <div class="empty-state" *ngIf="branches.length === 0 && !addBranchMode">
    <mat-icon class="huge-icon">map</mat-icon>
    <h3>No Branches Found</h3>
    <p>This workspace currently has no operational nodes.</p>
  </div>
</div>
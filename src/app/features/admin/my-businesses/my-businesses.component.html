<div class="workspace-wrapper">
  
  <header class="page-header">
    <div class="title-meta">
      <h1>My Workspaces</h1>
      <p>Manage your business entities and branch expansion.</p>
    </div>
    <button class="add-biz-btn" [class.cancel]="addBusinessMode" (click)="addBusinessMode = !addBusinessMode">
      <mat-icon>{{ addBusinessMode ? 'close' : 'add' }}</mat-icon>
      {{ addBusinessMode ? 'Cancel' : 'New Business' }}
    </button>
  </header>

  <div class="form-reveal" *ngIf="addBusinessMode">
    <app-add-business (businessAdded)="onBusinessAdded($event)"></app-add-business>
  </div>

  <div class="business-grid">
    <mat-card class="biz-card" *ngFor="let business of myBusinesses; let i = index">
      
      <div class="card-content-area">
        <div class="biz-badge">
          <mat-icon>domain</mat-icon>
        </div>

        <mat-card-header>
          <mat-card-title>{{ business.name }}</mat-card-title>
          <mat-card-subtitle>Business ID: {{ business._id.slice(-6) }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <p class="description">Control branch deployments, operational settings, and organizational metadata.</p>
        </mat-card-content>
      </div>

      <div class="action-drawer" [class.is-open]="addBranchMode === i + 1 || updateModeOn === i + 1">
        <button class="drawer-close" (click)="closeModes()">
          <mat-icon>close</mat-icon>
        </button>

        <div class="drawer-body">
          <div *ngIf="addBranchMode === i + 1" class="drawer-section">
            <label>New Branch Name</label>
            <div class="custom-input-group">
              <input [(ngModel)]="branchName" placeholder="e.g. Tbilisi Central" />
              <button (click)="addBranchToBusiness(business._id)">Add</button>
            </div>
          </div>

          <div *ngIf="updateModeOn === i + 1" class="drawer-section">
            <label>Update Name</label>
            <div class="custom-input-group">
              <input [(ngModel)]="businessUpdatedName" [placeholder]="business.name" />
              <button class="update-btn" (click)="updateBusiness(business._id, businessUpdatedName)">Save</button>
            </div>
          </div>
        </div>
      </div>

      <mat-card-actions class="biz-actions">
        <button mat-icon-button (click)="addBranchModeOn(i + 1)" title="Add Branch">
          <mat-icon>add_location_alt</mat-icon>
        </button>
        <button mat-icon-button (click)="onUpdateModeChange(i + 1)" title="Rename">
          <mat-icon>edit_note</mat-icon>
        </button>
        <button mat-icon-button class="btn-delete" (click)="deletebusiness(business._id)" title="Remove">
          <mat-icon>delete_outline</mat-icon>
        </button>
      </mat-card-actions>

    </mat-card>
  </div>

  <div class="empty-state" *ngIf="myBusinesses.length === 0">
    <mat-icon class="huge-icon">business_center</mat-icon>
    <h3>No Workspaces Detected</h3>
    <p>Create your first business workspace to start deploying branches.</p>
  </div>
</div>
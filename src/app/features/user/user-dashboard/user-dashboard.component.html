<div class="dashboard-container">
  <header class="welcome-header">
    <h1>Welcome, {{ user?.user?.name }}!</h1>
    <p>Select a branch to see PlayStation availability</p>
  </header>

  <div class="branch-selector">
    <div *ngFor="let branch of branches" 
         class="branch-chip" 
         [class.active]="selectedBranchId === branch._id"
         (click)="selectBranch(branch._id)">
      <span class="material-icons">location_on</span>
      {{ branch.name }}
    </div>
  </div>

  <div *ngIf="loadingItems" class="loading-msg">Fetching live status...</div>

  <div class="items-grid" *ngIf="selectedBranchId && !loadingItems">
    <div class="item-card" *ngFor="let item of items">
      <div class="item-top">
        <div class="ps-avatar">PS</div>
        <div class="ps-details">
          <h3>{{ item.name }}</h3>
          <span class="status-indicator">Online</span>
        </div>
        <button class="main-book-btn" (click)="handleReserve(item._id)">Book</button>
      </div>

      <div class="timeline-section">
        <label>
        Daily Schedule 
        <span class="live-dot"></span> 
        <small>(Live updates every 20s)</small>
        </label>
        <div class="bubbles-container">
          <div *ngFor="let slot of getTimeline(item._id)" 
               class="time-bubble" 
               [class.free]="slot.isFree"
               [class.busy]="!slot.isFree"
               (click)="slot.isFree ? handleReserve(item._id, slot) : null">
            <span class="time">{{ slot.start }}</span>
            <span class="sep">â†’</span>
            <span class="time">{{ slot.end }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>